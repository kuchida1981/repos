## Context

現在、GitHubのリポジトリ設定はブラウザのUIから手動で行われています。これにより、新しいリポジトリを作成するたびにブランチ保護ルールやマージ設定を個別に設定する必要があり、設定ミスやばらつきが生じています。本設計では、Terraformを使用してこれらの設定をコード化し、標準化された設定を再利用可能な形式で提供します。

## Goals / Non-Goals

**Goals:**
- GitHubリポジトリの設定（PR必須、直接Push禁止、マージ後のブランチ自動削除など）を共通モジュールとして提供する。
- 既存のリポジトリを、設定を損なうことなくTerraformの管理下に取り込む。
- 将来的なGitLab等の他プロバイダ対応を見据えた拡張性のあるディレクトリ構造を採用する。

**Non-Goals:**
- 今回の変更でGitLabやBitbucketのモジュール自体を実装すること（構造の準備のみ）。
- GitHub Actionsによる自動適用（Apply）パイプラインの構築（今回はローカル実行を前提とする）。
- リポジトリ内のコンテンツ（ファイル）の管理。

## Decisions

### 1. ディレクトリ構造の階層化
**決定:** `modules/repository/` という抽象化層を作成し、その下にプラットフォーム固有のロジック（今回はGitHub）を配置する。
**理由:** 将来的にGitLab等を追加する際、呼び出し側のインターフェースを変えずにプロバイダを切り替えられるようにするため。

### 2. Terraform 1.5+ `import` ブロックの利用
**決定:** 従来の `terraform import` コマンドではなく、コードベースの `import` ブロックを使用する。
**理由:** インポート対象がコードとして明示され、レビューが可能になるため。また、インポートと同時に標準設定への追随（Planでの確認）が行いやすいため。

### 3. 個人アクセストークン (PAT) による認証
**決定:** 環境変数 `GITHUB_TOKEN` を経由した認証を採用する。
**理由:** スモールスタートとして最も導入障壁が低く、かつ将来的にGitHub Actions等のCI環境へ移行する際もSecretsとして扱いやすいため。

## Risks / Trade-offs

- **[Risk] 設定の上書き** → `terraform apply` 時に、意図せず既存の特殊な設定が標準設定で上書きされる可能性がある。
  - **Mitigation:** 初回は必ず `terraform plan` の出力を詳細に確認し、必要に応じてモジュールに個別の変数（Override）を追加する。
- **[Risk] 承認ルールのロックアウト** → 一人開発のリポジトリで「承認1人必須」を強制すると、自分自身でマージできなくなる。
  - **Mitigation:** `required_approving_review_count` を変数化し、一人プロジェクトの場合は 0 に設定できるようにする。
- **[Trade-off] モジュールの複雑化** → 抽象化層を設けることで、単一プロバイダのみを扱う場合に比べて構造が一段複雑になる。
  - **Rationale:** 将来のマルチプラットフォーム対応という明確な目標があるため、初期投資として許容する。
